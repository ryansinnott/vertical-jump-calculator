<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0a0a0f">
    <title>Vertical Jump Calculator</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <!-- Screen 1: Welcome & Height Input -->
        <div id="screen-welcome" class="screen active">
            <div class="screen-content">
                <div class="logo">
                    <div class="logo-icon">
                        <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M32 8L32 56M32 8L20 20M32 8L44 20" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                            <circle cx="32" cy="44" r="6" fill="currentColor"/>
                        </svg>
                    </div>
                    <h1>Vertical Jump</h1>
                    <p class="subtitle">Measure your jump height with AI</p>
                </div>

                <div class="input-section">
                    <label class="input-label">Enter your height</label>
                    <div class="unit-toggle">
                        <button class="unit-btn active" data-unit="cm">cm</button>
                        <button class="unit-btn" data-unit="imperial">ft/in</button>
                    </div>

                    <div id="height-input-cm" class="height-input-group">
                        <div class="input-wrapper">
                            <input type="number" id="height-cm" placeholder="175" min="100" max="250">
                            <span class="input-suffix">cm</span>
                        </div>
                    </div>

                    <div id="height-input-imperial" class="height-input-group hidden">
                        <div class="input-wrapper">
                            <input type="number" id="height-ft" placeholder="5" min="3" max="8">
                            <span class="input-suffix">ft</span>
                        </div>
                        <div class="input-wrapper">
                            <input type="number" id="height-in" placeholder="9" min="0" max="11">
                            <span class="input-suffix">in</span>
                        </div>
                    </div>
                </div>

                <button id="btn-continue" class="btn btn-primary" disabled>Continue</button>
            </div>
        </div>

        <!-- Screen 2: Setup Instructions -->
        <div id="screen-instructions" class="screen">
            <div class="screen-content">
                <h2>Setup Instructions</h2>

                <div class="instruction-diagram">
                    <svg viewBox="0 0 200 150" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <!-- Phone -->
                        <rect x="10" y="60" width="20" height="35" rx="2" stroke="currentColor" stroke-width="2"/>
                        <circle cx="20" cy="70" r="3" fill="currentColor"/>
                        <!-- Person (side view) -->
                        <circle cx="140" cy="45" r="12" stroke="currentColor" stroke-width="2"/>
                        <line x1="140" y1="57" x2="140" y2="95" stroke="currentColor" stroke-width="2"/>
                        <line x1="140" y1="70" x2="125" y2="85" stroke="currentColor" stroke-width="2"/>
                        <line x1="140" y1="70" x2="155" y2="85" stroke="currentColor" stroke-width="2"/>
                        <line x1="140" y1="95" x2="130" y2="120" stroke="currentColor" stroke-width="2"/>
                        <line x1="140" y1="95" x2="150" y2="120" stroke="currentColor" stroke-width="2"/>
                        <!-- Ground -->
                        <line x1="5" y1="125" x2="195" y2="125" stroke="currentColor" stroke-width="1" stroke-dasharray="4"/>
                        <!-- Distance arrow -->
                        <line x1="30" y1="135" x2="130" y2="135" stroke="currentColor" stroke-width="1"/>
                        <polygon points="30,132 30,138 25,135" fill="currentColor"/>
                        <polygon points="130,132 130,138 135,135" fill="currentColor"/>
                        <text x="80" y="145" fill="currentColor" font-size="10" text-anchor="middle">6-10 ft</text>
                    </svg>
                </div>

                <ul class="checklist">
                    <li>
                        <span class="check-icon">1</span>
                        <span>Prop your phone up <strong>6-10 feet away</strong></span>
                    </li>
                    <li>
                        <span class="check-icon">2</span>
                        <span>Film from the <strong>side</strong> (perpendicular)</span>
                    </li>
                    <li>
                        <span class="check-icon">3</span>
                        <span>Ensure <strong>full body</strong> is visible in frame</span>
                    </li>
                    <li>
                        <span class="check-icon">4</span>
                        <span>Use <strong>good lighting</strong> and plain background</span>
                    </li>
                </ul>

                <div class="action-buttons">
                    <button id="btn-record" class="btn btn-primary">
                        <svg class="btn-icon" viewBox="0 0 24 24" fill="currentColor">
                            <circle cx="12" cy="12" r="8"/>
                        </svg>
                        Record Video
                    </button>
                    <button id="btn-upload" class="btn btn-secondary">
                        <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="17 8 12 3 7 8"/>
                            <line x1="12" y1="3" x2="12" y2="15"/>
                        </svg>
                        Upload Video
                    </button>
                </div>

                <input type="file" id="video-upload" accept="video/*" hidden>
            </div>
        </div>

        <!-- Screen 3a: Recording -->
        <div id="screen-recording" class="screen">
            <div class="recording-container">
                <video id="camera-preview" autoplay playsinline muted></video>

                <div id="countdown-overlay" class="countdown-overlay hidden">
                    <div class="countdown-number"></div>
                </div>

                <div id="recording-indicator" class="recording-indicator hidden">
                    <span class="rec-dot"></span>
                    <span class="rec-text">REC</span>
                    <span id="rec-timer" class="rec-timer">0:00</span>
                </div>

                <div class="recording-instructions">
                    <p id="recording-status">Preparing camera...</p>
                </div>

                <button id="btn-start-recording" class="btn btn-record hidden">
                    <span class="record-circle"></span>
                </button>

                <button id="btn-cancel-recording" class="btn-back">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Screen 3b: Upload Preview -->
        <div id="screen-upload" class="screen">
            <div class="screen-content">
                <h2>Review Video</h2>

                <div class="video-preview-container">
                    <video id="upload-preview" controls playsinline></video>
                </div>

                <p class="preview-hint">Make sure your full body and jump are visible</p>

                <div class="action-buttons">
                    <button id="btn-analyze-upload" class="btn btn-primary">Analyze Jump</button>
                    <button id="btn-reselect" class="btn btn-secondary">Choose Different Video</button>
                </div>
            </div>
        </div>

        <!-- Screen 4: Analyzing -->
        <div id="screen-analyzing" class="screen">
            <div class="screen-content centered">
                <div class="loader">
                    <div class="loader-ring"></div>
                    <div class="loader-ring"></div>
                    <div class="loader-ring"></div>
                </div>
                <h2>Analyzing Your Jump</h2>
                <p id="analysis-status" class="analysis-status">Loading AI model...</p>
            </div>
        </div>

        <!-- Screen 5: Results -->
        <div id="screen-results" class="screen">
            <div class="screen-content centered">
                <div class="result-card">
                    <div class="result-label">Your Vertical Jump</div>
                    <div class="result-height">
                        <span id="result-cm" class="result-number">0</span>
                        <span class="result-unit">cm</span>
                    </div>
                    <div class="result-height-alt">
                        <span id="result-inches">0</span> inches
                    </div>

                    <div id="result-category" class="result-category" data-category="average">
                        <span class="category-badge">Average</span>
                    </div>

                    <p id="result-context" class="result-context">
                        That's about average for the general population.
                    </p>
                </div>

                <button id="btn-try-again" class="btn btn-primary">Try Again</button>
            </div>
        </div>

        <!-- Error Screen -->
        <div id="screen-error" class="screen">
            <div class="screen-content centered">
                <div class="error-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="12" y1="8" x2="12" y2="12"/>
                        <line x1="12" y1="16" x2="12.01" y2="16"/>
                    </svg>
                </div>
                <h2>Oops!</h2>
                <p id="error-message" class="error-message">Something went wrong. Please try again.</p>
                <button id="btn-error-retry" class="btn btn-primary">Try Again</button>
            </div>
        </div>
    </div>

    <!-- TensorFlow.js and MoveNet -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/pose-detection@2.1.0/dist/pose-detection.min.js"></script>

    <script src="pose-analyzer.js"></script>
    <script src="app.js"></script>
</body>
</html>
